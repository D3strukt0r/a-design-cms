jobs:
  include:
    # CMS
    - language: php
      os: linux
      dist: bionic
      services:
        - docker

      script:
        - cd cms
        # Build and upload
        - ./travis-push-to-docker.sh

    # Frontend
    - language: node_js
      os: linux
      dist: bionic
      node_js:
        - stable

      cache:
        yarn: true
        directories:
          - node_modules

      before_install:
        - cd client

      install:
        - yarn install

      script:
        - yarn test
        - yarn build

      deploy:
        - provider: pages
          token: $GITHUB_TOKEN
          on:
            branch: master
          skip_cleanup: true
          local_dir: build
          repo: Generation-2/a-design-website-client-prod
          target_branch: master
          fqdn: a-design-web.generation-2.org

        - provider: pages
          token: $GITHUB_TOKEN
          on:
            branch: develop
          skip_cleanup: true
          local_dir: build
          repo: Generation-2/a-design-website-client-dev
          target_branch: master
          fqdn: a-design-dev-web.generation-2.org

notifications:
  email: false
